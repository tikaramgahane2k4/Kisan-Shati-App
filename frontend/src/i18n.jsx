import React, { createContext, useContext, useEffect, useMemo, useState } from 'react';

const translations = {
  en: {
    appName: 'AgriExpense',
    greeting: 'Namaste, {{name}}',
    farmerAccount: 'Farmer Account',
    logout: 'Logout',
    languageLabel: 'Language',
    farmOverview: 'Farm Overview',
    manageCrops: 'Manage your crops and seasonal expenses',
    addNewCrop: 'Add New Crop',
    noCrops: 'No crops added yet',
    startTracking: 'Start tracking your agricultural expenses by adding your first crop.',
    clickAddCrop: 'Click here to add a crop',
    landArea: 'Land Area',
    totalExpenses: 'Total Expenses',
    viewDetails: 'View Details',
    addNewCropTitle: 'Add New Crop',
    editCropTitle: 'Edit Crop',
    cropName: 'Crop Name',
    startDate: 'Start Date',
    locationOptional: 'Location (Optional)',
    notesOptional: 'Notes (Optional)',
    cancel: 'Cancel',
    saveCrop: 'Save Crop',
    updateCrop: 'Update Crop',
    edit: 'Edit',
    delete: 'Delete',
    deleteCropConfirm: 'Delete this crop? This will remove all expenses and sales.',
    backToDashboard: 'Back to Dashboard',
    downloadPdf: 'Download PDF Report',
    completeCrop: 'Complete Crop',
    reactivateCrop: 'Re-activate Crop',
    expenseLogs: 'Expense Logs',
    addExpense: 'Add Expense',
    recordExpense: 'Record Expense',
    editExpenseTitle: 'Edit Expense',
    saveExpense: 'Save Expense',
    updateExpense: 'Update Expense',
    welcomeBack: 'Welcome Back',
    manageFinances: 'Manage your crop finances efficiently',
    emailAddress: 'Email Address',
    password: 'Password',
    forgot: 'Forgot?',
    signIn: 'Sign In',
    dontHaveAccount: "Don't have an account?",
    registerNow: 'Register now',
    createAccount: 'Create Account',
    joinFarmers: 'Join 10,000+ farmers managing their fields',
    fullName: 'Full Name',
    confirm: 'Confirm',
    agreeToTerms: 'I agree to the',
    termsOfService: 'Terms of Service',
    and: 'and',
    privacyPolicy: 'Privacy Policy',
    registerAccount: 'Register Account',
    alreadyMember: 'Already a member?',
    logIn: 'Log In',
    startedOn: 'Started on {{date}}',
    financialSummary: 'Financial Summary',
    totalSpent: 'Total Spent',
    totalSalesLabel: 'Total Sales',
    profit: 'Profit',
    loss: 'Loss',
    costPerUnit: 'Cost per {{unit}}',
    cropDetailsTitle: 'Crop Details',
    locationLabel: 'Location',
    areaLabel: 'Area',
    notesLabel: 'Notes',
    noNotes: 'No notes added for this crop.',
    expenseTypeLabel: 'Expense Type',
    dateLabel: 'Date',
    descriptionLabel: 'Description',
    amountLabel: 'Amount',
    actionsLabel: 'Actions',
    grandTotal: 'Grand Total',
    noExpenses: 'No expenses recorded yet.',
    filterType: 'Type',
    searchLabel: 'Search',
    fromLabel: 'From',
    toLabel: 'To',
    showingCount: 'Showing {{filtered}} of {{total}} expenses',
    recordSaleTitle: 'Record Sale (Selling Price)',
    cropWeight: 'Crop Weight',
    ratePerUnit: 'Rate per {{unit}}',
    totalLabel: 'Total',
    descriptionOptional: 'Description (Optional)',
    saveSaleComplete: 'Save Sale & Complete',
    expenseType_labour: 'Labour',
    expenseType_tractor: 'Tractor',
    expenseType_threshing: 'Paddy Threshing',
    expenseType_fertilizer: 'Fertilizer',
    expenseType_seeds: 'Seeds',
    expenseType_irrigation: 'Paani',
    expenseType_other: 'Other',
    runningTime: 'Running Time',
    hours: 'Hours',
    minutes: 'Minutes',
    chargePerHour: 'Charge per Hour',
    ownerOperator: 'Owner/Operator Name',
    labourType: 'Labour Type',
    workingTime: 'Working Time',
    fullDay: 'Full Day',
    halfDay: 'Half Day',
    customHours: 'Custom Hours',
    chargePerPerson: 'Charge per Person',
    numberOfWorkers: 'Number of Workers',
    daysOfWork: 'Days of Work',
    workDescription: 'Work Description (Optional)',
    itemName: 'Item Name',
    unitPrice: 'Unit Price',
    quantity: 'Quantity',
    unitLabel: 'Unit',
    brandSupplier: 'Brand/Supplier (Optional)',
    notesOptionalLabel: 'Notes (Optional)',
    paymentMode: 'Payment Mode',
    billUpload: 'Bill/Photo Upload (Optional)',
    cropExpenseReport: 'Crop Expense Report',
    reportSubTitle: 'AgriExpense Digital Records',
    statusLabel: 'Status',
    generatedOn: 'Generated on',
    salesSummary: 'Sales Summary',
    noSalesRecorded: 'No sales recorded.',
    totalSalesFooter: 'TOTAL SALES',
    completeExpenseBreakdown: 'Complete Expense Breakdown',
    totalCost: 'TOTAL COST',
    farmerSignature: 'Farmer Signature'
  },
  hi: {
    appName: 'एग्रीएक्सपेंस',
    greeting: 'नमस्ते, {{name}}',
    farmerAccount: 'किसान खाता',
    logout: 'लॉगआउट',
    languageLabel: 'भाषा',
    farmOverview: 'खेत का सारांश',
    manageCrops: 'फसलों और मौसमी खर्चों का प्रबंधन करें',
    addNewCrop: 'नई फसल जोड़ें',
    noCrops: 'अभी कोई फसल नहीं जोड़ी गई',
    startTracking: 'अपना पहला खर्च जोड़कर रिकॉर्ड शुरू करें।',
    clickAddCrop: 'फसल जोड़ने के लिए यहाँ क्लिक करें',
    landArea: 'क्षेत्रफल',
    totalExpenses: 'कुल खर्च',
    viewDetails: 'विवरण देखें',
    addNewCropTitle: 'नई फसल जोड़ें',
    editCropTitle: 'फसल संपादित करें',
    cropName: 'फसल का नाम',
    startDate: 'आरंभ तिथि',
    locationOptional: 'स्थान (वैकल्पिक)',
    notesOptional: 'नोट्स (वैकल्पिक)',
    cancel: 'रद्द करें',
    saveCrop: 'फसल सेव करें',
    updateCrop: 'फसल अपडेट करें',
    edit: 'संपादित करें',
    delete: 'हटाएं',
    deleteCropConfirm: 'यह फसल हटाएं? सभी खर्च और बिक्री हट जाएंगे।',
    backToDashboard: 'डैशबोर्ड पर वापस',
    downloadPdf: 'पीडीएफ डाउनलोड करें',
    completeCrop: 'फसल पूर्ण करें',
    reactivateCrop: 'फसल पुनः सक्रिय करें',
    expenseLogs: 'खर्च का विवरण',
    addExpense: 'खर्च जोड़ें',
    recordExpense: 'खर्च दर्ज करें',
    editExpenseTitle: 'खर्च संपादित करें',
    saveExpense: 'खर्च सेव करें',
    updateExpense: 'खर्च अपडेट करें',
    welcomeBack: 'वापसी पर स्वागत है',
    manageFinances: 'फसल के खर्चों का प्रबंधन आसान बनाएं',
    emailAddress: 'ईमेल पता',
    password: 'पासवर्ड',
    forgot: 'भूल गए?',
    signIn: 'साइन इन',
    dontHaveAccount: 'खाता नहीं है?',
    registerNow: 'अभी रजिस्टर करें',
    createAccount: 'खाता बनाएं',
    joinFarmers: '10,000+ किसान अपना रिकॉर्ड संभाल रहे हैं',
    fullName: 'पूरा नाम',
    confirm: 'पुष्टि',
    agreeToTerms: 'मैं सहमत हूँ',
    termsOfService: 'सेवा शर्तें',
    and: 'और',
    privacyPolicy: 'गोपनीयता नीति',
    registerAccount: 'खाता रजिस्टर करें',
    alreadyMember: 'पहले से सदस्य हैं?',
    logIn: 'लॉग इन',
    startedOn: 'आरंभ तिथि {{date}}',
    financialSummary: 'वित्तीय सारांश',
    totalSpent: 'कुल खर्च',
    totalSalesLabel: 'कुल बिक्री',
    profit: 'लाभ',
    loss: 'हानि',
    costPerUnit: '{{unit}} प्रति लागत',
    cropDetailsTitle: 'फसल विवरण',
    locationLabel: 'स्थान',
    areaLabel: 'क्षेत्रफल',
    notesLabel: 'नोट्स',
    noNotes: 'इस फसल के लिए कोई नोट्स नहीं।',
    expenseTypeLabel: 'खर्च प्रकार',
    dateLabel: 'तारीख',
    descriptionLabel: 'विवरण',
    amountLabel: 'राशि',
    actionsLabel: 'कार्रवाई',
    grandTotal: 'कुल योग',
    noExpenses: 'अभी कोई खर्च दर्ज नहीं है।',
    filterType: 'प्रकार',
    searchLabel: 'खोजें',
    fromLabel: 'से',
    toLabel: 'तक',
    showingCount: '{{total}} में से {{filtered}} खर्च दिखा रहे हैं',
    recordSaleTitle: 'बिक्री दर्ज करें (विक्रय मूल्य)',
    cropWeight: 'फसल का वजन',
    ratePerUnit: '{{unit}} प्रति दर',
    totalLabel: 'कुल',
    descriptionOptional: 'विवरण (वैकल्पिक)',
    saveSaleComplete: 'बिक्री सेव करें और पूर्ण करें',
    expenseType_labour: 'मजदूरी',
    expenseType_tractor: 'ट्रैक्टर',
    expenseType_threshing: 'धान थ्रेशिंग',
    expenseType_fertilizer: 'खाद',
    expenseType_seeds: 'बीज',
    expenseType_irrigation: 'पानी',
    expenseType_other: 'अन्य',
    runningTime: 'चलने का समय',
    hours: 'घंटे',
    minutes: 'मिनट',
    chargePerHour: 'प्रति घंटा शुल्क',
    ownerOperator: 'मालिक/ऑपरेटर नाम',
    labourType: 'मजदूर प्रकार',
    workingTime: 'कार्य समय',
    fullDay: 'पूरा दिन',
    halfDay: 'आधा दिन',
    customHours: 'कस्टम घंटे',
    chargePerPerson: 'प्रति व्यक्ति शुल्क',
    numberOfWorkers: 'मजदूरों की संख्या',
    daysOfWork: 'काम के दिन',
    workDescription: 'काम का विवरण (वैकल्पिक)',
    itemName: 'आइटम का नाम',
    unitPrice: 'यूनिट कीमत',
    quantity: 'मात्रा',
    unitLabel: 'इकाई',
    brandSupplier: 'ब्रांड/आपूर्तिकर्ता (वैकल्पिक)',
    notesOptionalLabel: 'नोट्स (वैकल्पिक)',
    paymentMode: 'भुगतान माध्यम',
    billUpload: 'बिल/फोटो अपलोड (वैकल्पिक)',
    cropExpenseReport: 'फसल खर्च रिपोर्ट',
    reportSubTitle: 'AgriExpense डिजिटल रिकॉर्ड्स',
    statusLabel: 'स्थिति',
    generatedOn: 'बनाया गया',
    salesSummary: 'बिक्री सारांश',
    noSalesRecorded: 'कोई बिक्री दर्ज नहीं है।',
    totalSalesFooter: 'कुल बिक्री',
    completeExpenseBreakdown: 'खर्च का पूरा विवरण',
    totalCost: 'कुल लागत',
    farmerSignature: 'किसान हस्ताक्षर'
  },
  mr: {
    appName: 'अ‍ॅग्रीएक्स्पेन्स',
    greeting: 'नमस्कार, {{name}}',
    farmerAccount: 'शेतकरी खाते',
    logout: 'लॉगआउट',
    languageLabel: 'भाषा',
    farmOverview: 'शेतीचा आढावा',
    manageCrops: 'पिके आणि हंगामी खर्च व्यवस्थापित करा',
    addNewCrop: 'नवे पीक जोडा',
    noCrops: 'अद्याप कोणतेही पीक नाही',
    startTracking: 'पहिला खर्च जोडून नोंद सुरू करा.',
    clickAddCrop: 'पीक जोडण्यासाठी येथे क्लिक करा',
    landArea: 'क्षेत्रफळ',
    totalExpenses: 'एकूण खर्च',
    viewDetails: 'तपशील पहा',
    addNewCropTitle: 'नवे पीक जोडा',
    editCropTitle: 'पीक संपादित करा',
    cropName: 'पिकाचे नाव',
    startDate: 'सुरुवातीची तारीख',
    locationOptional: 'ठिकाण (ऐच्छिक)',
    notesOptional: 'नोंदी (ऐच्छिक)',
    cancel: 'रद्द करा',
    saveCrop: 'पीक सेव्ह करा',
    updateCrop: 'पीक अपडेट करा',
    edit: 'संपादित करा',
    delete: 'हटवा',
    deleteCropConfirm: 'हे पीक हटवायचे? सर्व खर्च आणि विक्री हटतील.',
    backToDashboard: 'डॅशबोर्डवर परत',
    downloadPdf: 'पीडीएफ डाउनलोड करा',
    completeCrop: 'पीक पूर्ण करा',
    reactivateCrop: 'पीक पुन्हा सक्रिय करा',
    expenseLogs: 'खर्च नोंदी',
    addExpense: 'खर्च जोडा',
    recordExpense: 'खर्च नोंद करा',
    editExpenseTitle: 'खर्च संपादित करा',
    saveExpense: 'खर्च सेव्ह करा',
    updateExpense: 'खर्च अपडेट करा',
    welcomeBack: 'परत स्वागत आहे',
    manageFinances: 'पिकांचे खर्च सहज व्यवस्थापित करा',
    emailAddress: 'ईमेल पत्ता',
    password: 'पासवर्ड',
    forgot: 'विसरलात?',
    signIn: 'साइन इन',
    dontHaveAccount: 'खाते नाही?',
    registerNow: 'आत्ताच नोंदणी करा',
    createAccount: 'खाते तयार करा',
    joinFarmers: '10,000+ शेतकरी नोंदी सांभाळत आहेत',
    fullName: 'पूर्ण नाव',
    confirm: 'पुष्टी',
    agreeToTerms: 'मी सहमत आहे',
    termsOfService: 'सेवा अटी',
    and: 'आणि',
    privacyPolicy: 'गोपनीयता धोरण',
    registerAccount: 'खाते नोंदवा',
    alreadyMember: 'आधीच सदस्य आहात?',
    logIn: 'लॉग इन',
    startedOn: 'सुरुवात {{date}}',
    financialSummary: 'आर्थिक सारांश',
    totalSpent: 'एकूण खर्च',
    totalSalesLabel: 'एकूण विक्री',
    profit: 'नफा',
    loss: 'तोटा',
    costPerUnit: '{{unit}} प्रति खर्च',
    cropDetailsTitle: 'पीक तपशील',
    locationLabel: 'ठिकाण',
    areaLabel: 'क्षेत्रफळ',
    notesLabel: 'नोंदी',
    noNotes: 'या पिकासाठी नोंदी नाहीत.',
    expenseTypeLabel: 'खर्च प्रकार',
    dateLabel: 'तारीख',
    descriptionLabel: 'वर्णन',
    amountLabel: 'रक्कम',
    actionsLabel: 'कृती',
    grandTotal: 'एकूण',
    noExpenses: 'अद्याप खर्च नोंद नाही.',
    filterType: 'प्रकार',
    searchLabel: 'शोधा',
    fromLabel: 'पासून',
    toLabel: 'पर्यंत',
    showingCount: '{{total}} पैकी {{filtered}} खर्च दाखवत आहे',
    recordSaleTitle: 'विक्री नोंदवा (विक्री किंमत)',
    cropWeight: 'पिकाचे वजन',
    ratePerUnit: '{{unit}} प्रति दर',
    totalLabel: 'एकूण',
    descriptionOptional: 'वर्णन (ऐच्छिक)',
    saveSaleComplete: 'विक्री सेव्ह करा आणि पूर्ण करा',
    expenseType_labour: 'मजुरी',
    expenseType_tractor: 'ट्रॅक्टर',
    expenseType_threshing: 'भात थ्रेशिंग',
    expenseType_fertilizer: 'खत',
    expenseType_seeds: 'बियाणे',
    expenseType_irrigation: 'पाणी',
    expenseType_other: 'इतर',
    runningTime: 'चालू वेळ',
    hours: 'तास',
    minutes: 'मिनिटे',
    chargePerHour: 'प्रति तास शुल्क',
    ownerOperator: 'मालक/ऑपरेटर नाव',
    labourType: 'मजूर प्रकार',
    workingTime: 'कामाचा वेळ',
    fullDay: 'पूर्ण दिवस',
    halfDay: 'अर्धा दिवस',
    customHours: 'कस्टम तास',
    chargePerPerson: 'प्रति व्यक्ती शुल्क',
    numberOfWorkers: 'मजुरांची संख्या',
    daysOfWork: 'कामाचे दिवस',
    workDescription: 'कामाचे वर्णन (ऐच्छिक)',
    itemName: 'आयटमचे नाव',
    unitPrice: 'युनिट किंमत',
    quantity: 'प्रमाण',
    unitLabel: 'एकक',
    brandSupplier: 'ब्रँड/पुरवठादार (ऐच्छिक)',
    notesOptionalLabel: 'नोंदी (ऐच्छिक)',
    paymentMode: 'पेमेंट मोड',
    billUpload: 'बिल/फोटो अपलोड (ऐच्छिक)',
    cropExpenseReport: 'पीक खर्च अहवाल',
    reportSubTitle: 'AgriExpense डिजिटल रेकॉर्ड्स',
    statusLabel: 'स्थिती',
    generatedOn: 'तयार केले',
    salesSummary: 'विक्री सारांश',
    noSalesRecorded: 'विक्री नोंद नाही.',
    totalSalesFooter: 'एकूण विक्री',
    completeExpenseBreakdown: 'खर्चाचा संपूर्ण तपशील',
    totalCost: 'एकूण खर्च',
    farmerSignature: 'शेतकरी स्वाक्षरी'
  }
};

const LanguageContext = createContext({
  language: 'en',
  setLanguage: () => {},
  t: (key) => key
});

const interpolate = (template, vars) => {
  if (!vars) return template;
  return template.replace(/\{\{(\w+)\}\}/g, (_, k) => vars[k] ?? '');
};

export const LanguageProvider = ({ children }) => {
  const [language, setLanguage] = useState(() => localStorage.getItem('agri_lang') || 'en');

  useEffect(() => {
    localStorage.setItem('agri_lang', language);
  }, [language]);

  const t = useMemo(() => {
    return (key, vars) => {
      const value = translations[language]?.[key] ?? translations.en[key] ?? key;
      return interpolate(value, vars);
    };
  }, [language]);

  return (
    <LanguageContext.Provider value={{ language, setLanguage, t }}>
      {children}
    </LanguageContext.Provider>
  );
};

export const useTranslation = () => useContext(LanguageContext);
